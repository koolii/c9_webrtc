{"changed":true,"filter":false,"title":"web_chat.js","tooltip":"/web/js/web_chat.js","value":"$(function() {\n\t\n\tvar connections = {};\n\t\n\tvar Connection = function() {\n\t\tthis.self = this;\n\t\tthis.partnerId = \"\";\n\t\tthis.IsEstablished = false;\n\t\tthis.IsExchanged = false;\n\t\tthis.peerConnection = null;\n\t};\n\t\n\tfunction getConnection(id) {\n\t\treturn connections[id];\n\t}\n\t\n\tfunction removeConnection(id) {\n\t\tdelete connections[id];\n\t\t// delete connections[id]\n\t}\n\t\n\tfunction addConnection(id, connection) {\n\t\tconnections[id] = connection;\n\t}\n\t\n\tfunction getConnectionCnt() {\n\t\treturn connections.length;\n\t}\n\t\n\t// CLIENT FUNCTION\n\tvar CLIENT_ID;\n\t\n\t// ベンダープレフィックスを除外\n\tRTCPeerConnection = webkitRTCPeerConnection ||\n\t\tmozRTCPeerConnection ||\n\t\tmsRTCPeerConnection ||\n\t\tRTCPeerConnection;\n\n    // navigator.getUserMediaに統一\n\tnavigator.getUserMedia = navigator.getUserMedia ||\n\t\tnavigator.webkitGetUserMedia ||\n\t\tnavigator.mozGetUserMedia ||\n\t\tnavigator.msGetUserMedia;\n\t\n\t// window.URLに統一\n\tURL = window.URL || window.webkitURL;\n\t\n\t// WebSocket接続\n\tvar socket = io.connect();\n\t\n\t\t// OnOpenが呼び出されているか確かめる\n\tsocket.on('connect', function (message) {\n\t\tconsole.log(\"broadcast on_open log\");\n\t\t\n\t\t//var json = JSON.parse(message);\n\n\t\t//console.log(\"connection_id is \" + json.connection_id);\n\t});\n\n\t\t\n\tvar mediaConstraints = {\n\t\t'mandatory': {\n\t\t\t\t'OfferToReceiveAudio': false, \n\t\t\t\t'OfferToReceiveVideo': true,\n\t\t\t\t'IceRestart': true\n\t\t}\n\t};\n\t\n\tvar peerConnection = prepareNewConnection();\n\tvar localStream, remoteStream;\n\t\n\t\n\t// 接続する際にいくつのコネクションを張るかサーバに問い合わせ\n\t$(\".test\").on(\"event\", function() {\n\t\t\tsocket.emit(\"clients\", socket.id);\n\t});\n\t\n\tsocket.on(\"clients\", function(remoteConnections) {\n\t\t\n\t});\n\t\n\t// Click Event of Connect\n\t$(\"#connect\").on(\"click\", connect);\n\t\n\tfunction connect() {\n\t\tsendOffer();\n\t}\n\t\n\tfunction sendOffer() {\n\t\tif (!peerConnection) {\n\t\t\t//console.log('peerConnection not exist! AND Create peerConnection');\n\t  \t\tpeerConnection = prepareNewConnection();\t\n\t\t}\n\t\t\n\t\t//console.log(\"sendOffer() iceConnectionState is \" + peerConnection.iceConnectionState);\n\n\t\tpeerConnection.addStream(localStream);\n\t\tconsole.log(\"------add localStream------\");\n\n\t\tpeerConnection.createOffer(function(sessionDescription){\n\t\t\tpeerConnection.setLocalDescription(sessionDescription);\n\t\t\tsocket.emit(\"sendOffer\", JSON.stringify({sdp: sessionDescription, guid: CLIENT_ID}));\n\t\t\tconsole.log(\"Create Offer Success\");\n\t\t},\n\t\tfunction() {\n\t\t\tconsole.log(\"Create Offer Failed\");\n\t\t}, mediaConstraints);\n\t}\n\t\n\tfunction prepareNewConnection() {\n\t\tif (peerConnection) {\n\t  \t\tconsole.log('peerConnection alreay exist!');\n\t  \t\treturn peerConnection;\n\t  \t}\n\t\t\n\t\tvar peer = new RTCPeerConnection({\n          'iceServers': [\n            // {url:'stun:stun01.sipphone.com'},\n            // {url:'stun:stun.ekiga.net'},\n            // {url:'stun:stun.fwdnet.net'},\n            // {url:'stun:stun.ideasip.com'},\n            // {url:'stun:stun.iptel.org'},\n            // {url:'stun:stun.rixtelecom.se'},\n            // {url:'stun:stun.schlund.de'},\n            {url:'stun:stun.l.google.com:19302'},\n            // {url:'stun:stun1.l.google.com:19302'},\n            // {url:'stun:stun2.l.google.com:19302'},\n            // {url:'stun:stun3.l.google.com:19302'},\n            // {url:'stun:stun4.l.google.com:19302'},\n            // {url:'stun:stunserver.org'},\n            // {url:'stun:stun.softjoys.com'},\n            // {url:'stun:stun.voiparound.com'},\n            // {url:'stun:stun.voipbuster.com'},\n            // {url:'stun:stun.voipstunt.com'},\n            // {url:'stun:stun.voxgratia.org'},\n            // {url:'stun:stun.xten.com'},\n            // { url: 'stun:stun.skyway.io:3478' },\n            // {\n            //     url: 'turn:numb.viagenie.ca',\n            //     credential: 'muazkh',\n            //     username: 'webrtc@live.com'\n            // },\n            // {\n            //     url: 'turn:192.158.29.39:3478?transport=udp',\n            //     credential: 'JZEOEt2V3Qb0y27GRntt2u2PAYA=',\n            //     username: '28224511:1379330808'\n            // },\n            // {\n            //     url: 'turn:192.158.29.39:3478?transport=tcp',\n            //     credential: 'JZEOEt2V3Qb0y27GRntt2u2PAYA=',\n            //     username: '28224511:1379330808'\n            // },\n            // // {\n            //     url: 'turn:homeo@turn.bistri.com:80',\n            //     credential: 'homeo'\n            // }\n          ]\n        });\n\t\t\n\t\tpeer.onicecandidate = function (evt) {\n\t\t\tconsole.log(\"iceGatheringState is \" + evt.target.iceGatheringState);\n\t\t\t\n\t\t\tif (evt.candidate) {\n\t\t\t\tconsole.log(evt.candidate);\n\t\t\t\tsocket.emit(\"candidate\", JSON.stringify({ candidate: evt.candidate, guid: CLIENT_ID}));\n\t\t\t} else {\n\t\t\t\tconsole.log(\"End of candidates.\");\n\t\t\t\t\n\t\t\t\t// var iceState = peerConnection.iceConnectionState;\n\t\t\t\t\n\t\t\t\t// if (iceState == \"connected\" || iceState == \"complete\")return;\n\t\t\t\t\n\t\t\t\t// if ((iceState == \"checking\" || iceState == \"failed\") || evt.target.iceGatheringState == \"complete\") {\n\t\t\t\t//     console.log(\"------Resend offer on the end of candidate------\");\n\t\t\t\t//     sendOffer();\n\t\t\t\t// }\n\t\t\t}\n\t\t};\n\t\t\n\t\tpeer.onnegotiationneeded = function(evt) {\n\t\t\tconsole.log(\"------on negotiation callback------\");\n\t\t\t// socket.trigger(\"sendOffer\", evt);\n\t\t}\n\t\t\n\t\tpeer.onaddstream = onRemoteStreamAdded;\n\t\t\n\t\tpeer.oniceconnectionstatechange = function(evt) {\n\t\t    console.log(\"ICE connection state change: \" + evt.target.iceConnectionState);\n\t\t    \n\t\t    console.log(\"testtesttesttest \" + peer.iceConnectionState);\n\t\t    \n\t\t    if(peer.iceConnectionState == 'completed') {\n\t\t      var message = 'WebRTC RTP ports are connected to UDP. ';\n\t\t      message += 'Wait a few seconds for remote stream to be started flowing.';\n\t\t      alert(message);\n\t\t    }\n\t\t    // don't move\n\t\t    // if (evt.target.iceConnectionState == \"failed\") {\n\t\t    // \tsendOffer();\n\t\t    // \tconsole.log(\"------Resend Offer oniceconnectionstatechange------\");\n\t\t    // }\n\t\t};\n\n\t\treturn peer;\n\t}\n\t\n\t// Callback sendOffer\n\tsocket.on(\"sendOffer\", onOffer);\n\t\n\tfunction onOffer(evt) {\n\t    var json = JSON.parse(evt);\n\n// \t\tif(json.guid == CLIENT_ID) return;\n\t\tconsole.log(\"------receive offer------\");\n\t\t\n\t\t// console.log(\"onOffer() iceConnectionState is \" + peerConnection.iceConnectionState);\n\t\t\n\t\tsetOffer(json);\n\t\tsendAnswer(json);\n\t}\n\t\n\tfunction setOffer(evt) {\n\t    // console.log(\"setOffer() iceConnectionState is \" + peerConnection.iceConnectionState);\n\t\tpeerConnection = prepareNewConnection();\n\t\tpeerConnection.setRemoteDescription(new RTCSessionDescription(evt.sdp));\n\t}\n\t\n\tfunction sendAnswer(evt) {\n\t    if (!peerConnection || peerConnection.remoteDescription.type != \"offer\")return;\n\n\t    // console.log(\"sendAnswer() iceConnectionState is \" + peerConnection.iceConnectionState);\n\t\tpeerConnection.createAnswer(function(sdp) {\n\t\t    peerConnection.setLocalDescription(sdp);\n\t\t\tsocket.json.send emit(\"sendAnswer\", JSON.stringify({sdp: sdp, guid: CLIENT_ID}));\n\t\t\tconsole.log(\"Create Answer Success\");\n\t\t},\n\t\tfunction() {\n\t\t\tconsole.log(\"Create Answer Failed\");\n\t\t}, mediaConstraints);\n\t}\n\t\n\t// Callback sendAnswer\n\tsocket.on(\"sendAnswer\", onAnswer);\n\t\n\tfunction onAnswer(evt) {\n\t\tvar json = JSON.parse(evt);\n\t\t\n\t\tif (!peerConnection) {\n\t\t\tconsole.log(\"Error peerConnection NOT EXIST!!\");\n\t\t\treturn;\n\t\t}\n\n\t\t// console.log(\"onAnswer() iceConnectionState is \" + peerConnection.iceConnectionState);\n\n\t\t// peerConnection.createOffer(function(sdp) {\n\t\t\t// peerConnection.setLocalDescription(sdp);\n\t\t// });\n\t\tsetAnswer(json);\n\t}\n\t\n\tfunction setAnswer(evt) {\n// \t\tif(evt.guid == CLIENT_ID) return;\n\n\t\tconsole.log(\"------receive answer------\");\n\t\t// console.log(\"setAnswer() iceConnectionState is \" + peerConnection.iceConnectionState);\n\t\t\n\t\tvar sdp = new RTCSessionDescription(evt.sdp);\n\t\t// if (evt.guid != GUID) {\n\t\t\tpeerConnection.setRemoteDescription(sdp);\n\t\t\tconsole.log(\"------set remoteDescription------\");\n\t\t// }\n\t}\n\t\n\tsocket.on(\"candidate\", onCandidate);\n\t\n\tfunction onCandidate(evt) {\n\t  var json = JSON.parse(evt);\n\t  // console.log(\"!!!!!!callback of candidate!!!!!!\");\n\t  console.log(\"onCandidate() iceConnectionState is \" + peerConnection.iceConnectionState);\n\n\t  peerConnection.addIceCandidate(new RTCIceCandidate(json.candidate),\n\t    function(evt) { \n\t      console.log(\"success\"); \n\t    }, \n\t    function(evt) { \n\t          console.log(\"error\"); \n\t    });\n\t}\n\t\n\tfunction onRemoteStreamAdded(evt) {\n      console.log(\"Added Remote Stream\");\n      \n      console.log(\"Remote Stream is \" + evt.stream);\n      $(\"#remote_tv\")[0].src = URL.createObjectURL(evt.stream);\n      $(\"#remote_tv\")[0].play();\n\n      console.log(\"onRemoteStreamAdded() iceConnectionState is \" + peerConnection.iceConnectionState);\n      console.log(\"srcElement's iceConnectionState is \" + evt.srcElement.iceConnectionState);\n      console.log(\"target's iceConnectionState is \" + evt.target.iceConnectionState);\n      console.log(\"currentTarget's iceConnectionState is \" + evt.currentTarget.iceConnectionState);\n    }\n\t\n\t// navigator.getUserMediaを実行\n\tif (!navigator.getUserMedia) {\n\t\talert(\"WebRTC is not supported!!\");\n\t\treturn false;\n\t} else {\n\t\tnavigator.getUserMedia({video: true, audio: false}, function(stream) {\n\t\t\t// video要素の取得\n\t\t\tvar video = $(\"#my_tv\")[0];\n\t\t\t\n\t\t\t// srcにBlob URLを指定するとカメラの画像がストリームで流れる\n\t        video.src = URL.createObjectURL(stream);\n\t        video.play();\n\t        \n\t        // 自分のpeerにカメラストリームを接続させる\n\t        // RTC接続確立後に相手のストリームに渡される\n\t        localStream = stream;\n\t\t\t \n\t\t}, function(error) {\n\t\t\talert(error.name);\n\t\t});\n\t}\n\t\n\t\n\t// メッセージ受信時の処理\n    socket.on(\"websocket_chat\", function(message){\n  \t  console.log(\"websocket_chat message is \" + message);\n    });\n    \n    \n    socket.on(\"disconnect\", function(removeConnectionId) {\n    \tconsole.log(removeConnectionId + \"'s client out\");\t\n    \tremoveConnection(removeConnectionId);\n    });\n\n\t// メッセージ送信時の処理\n\t$(\"#send\").on(\"click\", function(){\n\t　var comment = $(\"#comment\").val();\n\t　socket.emit('websocket_chat', comment);\n\t});\n\n});\n","undoManager":{"mark":92,"position":100,"stack":[[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":334,"column":44},"end":{"row":334,"column":45}},"text":"i"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":334,"column":45},"end":{"row":334,"column":46}},"text":"o"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":334,"column":46},"end":{"row":334,"column":47}},"text":"n"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":334,"column":47},"end":{"row":334,"column":48}},"text":"I"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":334,"column":48},"end":{"row":334,"column":49}},"text":"d"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":335,"column":18},"end":{"row":335,"column":19}},"text":"'"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":335,"column":19},"end":{"row":335,"column":20}},"text":"s"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":335,"column":20},"end":{"row":335,"column":21}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":335,"column":21},"end":{"row":335,"column":22}},"text":"u"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":335,"column":22},"end":{"row":335,"column":23}},"text":"s"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":335,"column":23},"end":{"row":335,"column":24}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":335,"column":24},"end":{"row":335,"column":25}},"text":"r"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":335,"column":24},"end":{"row":335,"column":25}},"text":"r"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":335,"column":23},"end":{"row":335,"column":24}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":335,"column":22},"end":{"row":335,"column":23}},"text":"s"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":335,"column":21},"end":{"row":335,"column":22}},"text":"u"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":335,"column":21},"end":{"row":335,"column":22}},"text":"c"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":335,"column":22},"end":{"row":335,"column":23}},"text":"l"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":335,"column":23},"end":{"row":335,"column":24}},"text":"i"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":335,"column":24},"end":{"row":335,"column":25}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":335,"column":25},"end":{"row":335,"column":26}},"text":"n"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":335,"column":26},"end":{"row":335,"column":27}},"text":"t"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":335,"column":27},"end":{"row":335,"column":28}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":335,"column":28},"end":{"row":335,"column":29}},"text":"d"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":335,"column":29},"end":{"row":335,"column":30}},"text":"i"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":335,"column":29},"end":{"row":335,"column":30}},"text":"i"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":335,"column":28},"end":{"row":335,"column":29}},"text":"d"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":335,"column":28},"end":{"row":335,"column":29}},"text":"o"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":335,"column":29},"end":{"row":335,"column":30}},"text":"u"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":335,"column":30},"end":{"row":335,"column":31}},"text":"t"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":335,"column":17},"end":{"row":335,"column":18}},"text":"c"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":335,"column":18},"end":{"row":335,"column":19}},"text":"o"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":335,"column":19},"end":{"row":335,"column":20}},"text":"n"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":335,"column":20},"end":{"row":335,"column":21}},"text":"n"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":335,"column":21},"end":{"row":335,"column":22}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":335,"column":22},"end":{"row":335,"column":23}},"text":"c"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":335,"column":23},"end":{"row":335,"column":24}},"text":"t"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":335,"column":24},"end":{"row":335,"column":25}},"text":"i"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":335,"column":25},"end":{"row":335,"column":26}},"text":"o"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":335,"column":26},"end":{"row":335,"column":27}},"text":"n"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":335,"column":17},"end":{"row":335,"column":27}},"text":"connection"},{"action":"insertText","range":{"start":{"row":335,"column":17},"end":{"row":335,"column":29}},"text":"connectionId"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":335,"column":29},"end":{"row":335,"column":30}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":335,"column":30},"end":{"row":335,"column":31}},"text":"+"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":335,"column":31},"end":{"row":335,"column":32}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":2},"end":{"row":17,"column":3}},"text":"d"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":3},"end":{"row":17,"column":4}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":4},"end":{"row":17,"column":5}},"text":"l"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":5},"end":{"row":17,"column":6}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":6},"end":{"row":17,"column":7}},"text":"t"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":7},"end":{"row":17,"column":8}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":8},"end":{"row":17,"column":9}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":17,"column":28},"end":{"row":17,"column":29}},"text":"\""}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":17,"column":27},"end":{"row":17,"column":28}},"text":"\""}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":17,"column":26},"end":{"row":17,"column":27}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":17,"column":25},"end":{"row":17,"column":26}},"text":"="}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":17,"column":24},"end":{"row":17,"column":25}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":335,"column":50},"end":{"row":336,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":336,"column":0},"end":{"row":336,"column":5}},"text":"    \t"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":336,"column":5},"end":{"row":336,"column":21}},"text":"removeConnection"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":336,"column":21},"end":{"row":336,"column":23}},"text":"()"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":336,"column":23},"end":{"row":336,"column":24}},"text":";"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":336,"column":22},"end":{"row":336,"column":23}},"text":"c"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":336,"column":23},"end":{"row":336,"column":24}},"text":"o"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":336,"column":24},"end":{"row":336,"column":25}},"text":"n"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":336,"column":25},"end":{"row":336,"column":26}},"text":"n"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":336,"column":26},"end":{"row":336,"column":27}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":336,"column":27},"end":{"row":336,"column":28}},"text":"c"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":336,"column":28},"end":{"row":336,"column":29}},"text":"t"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":334,"column":37},"end":{"row":334,"column":49}},"text":"connectionId"},{"action":"insertText","range":{"start":{"row":334,"column":37},"end":{"row":334,"column":38}},"text":"r"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":334,"column":38},"end":{"row":334,"column":39}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":334,"column":39},"end":{"row":334,"column":40}},"text":"m"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":334,"column":40},"end":{"row":334,"column":41}},"text":"o"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":334,"column":41},"end":{"row":334,"column":42}},"text":"v"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":334,"column":42},"end":{"row":334,"column":43}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":334,"column":43},"end":{"row":334,"column":44}},"text":"C"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":334,"column":44},"end":{"row":334,"column":45}},"text":"o"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":334,"column":45},"end":{"row":334,"column":46}},"text":"n"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":334,"column":46},"end":{"row":334,"column":47}},"text":"n"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":334,"column":47},"end":{"row":334,"column":48}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":334,"column":48},"end":{"row":334,"column":49}},"text":"c"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":334,"column":49},"end":{"row":334,"column":50}},"text":"t"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":334,"column":50},"end":{"row":334,"column":51}},"text":"i"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":334,"column":51},"end":{"row":334,"column":52}},"text":"o"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":334,"column":52},"end":{"row":334,"column":53}},"text":"n"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":334,"column":53},"end":{"row":334,"column":54}},"text":"I"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":334,"column":54},"end":{"row":334,"column":55}},"text":"d"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":335,"column":17},"end":{"row":335,"column":29}},"text":"connectionId"},{"action":"insertText","range":{"start":{"row":335,"column":17},"end":{"row":335,"column":35}},"text":"removeConnectionId"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":336,"column":22},"end":{"row":336,"column":29}},"text":"connect"},{"action":"insertText","range":{"start":{"row":336,"column":22},"end":{"row":336,"column":40}},"text":"removeConnectionId"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":332,"column":7},"end":{"row":333,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":333,"column":0},"end":{"row":333,"column":4}},"text":"    "}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":326,"column":1},"end":{"row":326,"column":2}},"text":"\t"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":326,"column":0},"end":{"row":326,"column":1}},"text":"\t"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":325,"column":22},"end":{"row":326,"column":0}},"text":"\n"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":326,"column":0},"end":{"row":326,"column":4}},"text":"\t});"},{"action":"removeLines","range":{"start":{"row":324,"column":0},"end":{"row":326,"column":0}},"nl":"\n","lines":["\t$(window).on(\"beforeunload\", function() {","\t\tsocket.disconnect();"]}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":323,"column":1},"end":{"row":324,"column":0}},"text":"\n"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":233,"column":10},"end":{"row":233,"column":11}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":233,"column":10},"end":{"row":233,"column":11}},"text":"j"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":233,"column":11},"end":{"row":233,"column":12}},"text":"s"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":233,"column":12},"end":{"row":233,"column":13}},"text":"o"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":233,"column":13},"end":{"row":233,"column":14}},"text":"n"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":233,"column":14},"end":{"row":233,"column":15}},"text":"."}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":233,"column":15},"end":{"row":233,"column":16}},"text":"s"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":233,"column":15},"end":{"row":233,"column":16}},"text":"s"},{"action":"insertText","range":{"start":{"row":233,"column":15},"end":{"row":233,"column":19}},"text":"send"}]}]]},"ace":{"folds":[],"scrolltop":720,"scrollleft":0,"selection":{"start":{"row":57,"column":4},"end":{"row":57,"column":4},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1409694527806}